# Phase 2: Research 模块适配任务清单

**对应阶段**: Phase 2
**目标**: 通过适配器模式封装 `doc_research` 和 `deep_research`，使其成为标准化的内部工具，输出统一格式的 `report.md`。

---

## 2.1 基础适配器接口 (`adapters/base.py`)
- [x] **定义 `BaseAdapter` 抽象类**
    - **方法**: `run(context: dict) -> dict`
    - **规范**:
        - 输入必须包含任务上下文。
        - 输出必须包含生成文件的路径或内容摘要。

## 2.2 Doc Research 适配器 (`adapters/doc_research_adapter.py`)
- [x] **源码分析与引用**
    - 确认引用路径：`ms_agent.app.doc_research` 或底层 `ms_agent.workflow.doc_research_workflow`。
    - **注意**: 避免引入 `gradio` 相关的 GUI 依赖，只引用逻辑层。
- [x] **实现 `DocResearchAdapter` 类**
    - **初始化**: 接收 `config` 对象。
    - **方法 `run(file_paths: list[str], urls: list[str])`**:
        1. 构造 `ResearchWorkflow` 实例。
        2. 调用其 `run` 方法 (注意是同步还是异步)。
        3. 捕获生成的 Markdown 内容。
        4. 将内容写入工作区的 `report.md`。
    - **处理**: 自动处理多文件合并逻辑（如果底层不支持，需在 Adapter 层拼接）。

## 2.3 Deep Research 适配器 (`adapters/deep_research_adapter.py`)
- [x] **源码分析**
    - 查看 `projects/deep_research/run.py`。
    - 确认是否支持作为库调用，还是需要用 `subprocess` 调用 CLI。
- [x] **实现 `DeepResearchAdapter` 类**
    - **策略**: 优先尝试作为库导入 (`from projects.deep_research... import ...`)。如果依赖冲突严重，回退到 `subprocess.run`。
    - **方法 `run(query: str)`**:
        1. 配置 Deep Research 的运行参数 (搜索深度、广度等)。
        2. 执行搜索与总结任务。
        3. 提取最终的总结报告。
        4. 写入工作区的 `report.md`。

## 2.4 统一入口与分发逻辑
- [x] **更新 `main.py` 或创建 `core/dispatcher.py`**
    - **逻辑**:
        - 如果用户提供了 `--files` 或 `--urls` -> 调用 `DocResearchAdapter`。
        - 如果仅提供 `query` -> 调用 `DeepResearchAdapter`。
        - (进阶) 如果两者都有 -> 先 Deep 搜索背景，再结合 Doc 分析 (V2特性，暂不实现)。

## 2.5 验证与测试计划
- [x] **单元测试 (Mock)**
- [x] **集成测试 (手动)**
