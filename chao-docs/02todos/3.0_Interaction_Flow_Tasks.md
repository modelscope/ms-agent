# Phase 3: 交互控制与数据流转任务清单

**对应阶段**: Phase 3
**目标**: 串联各个模块，实现 Human-in-the-Loop (HITL) 机制，并定义 Role B (Spec/Test) 和 Role C (Code) 的交互契约。

---

## 3.1 交互流程控制器 (`core/flow.py`)
- [x] **设计 `FlowController` 类**
    - **依赖**: `WorkspaceManager`, `Logger`.
- [x] **实现 `wait_for_human_review(file_path: str)`**
    - **功能**:
        1. 打印提示信息："Artifact generated at {file_path}. Please review and edit if necessary."
        2. 打印选项："[C]ontinue processing, [R]eload and view, [E]xit"。
        3. 阻塞等待用户输入。
        4. 如果用户选择 Continue，重新读取文件内容（确保捕获了用户的修改）。
    - **注意**: 确保在非交互模式下（如 CI 环境）可以跳过或设置超时。

## 3.2 Role B (Spec & Test) 接口契约 (Mock)
> 注：Role B 的具体 Agent 实现由队友完成，此处仅实现调用接口。

- [x] **定义 Spec 生成接口 (`adapters/spec_adapter.py`)**
    - **Input**: `report.md` 内容。
    - **Output**: `tech_spec.md` (包含 API 签名、数据结构、依赖)。
    - **Mock 实现**: 暂时写一个简单的函数，直接根据 Report 复制一份作为 Spec，或者追加一段固定文本，用于跑通流程。
- [x] **定义 Test 生成接口 (`adapters/test_gen_adapter.py`)**
    - **Input**: `tech_spec.md` 内容。
    - **Output**: 写入 `tests/` 目录下的 `test_core.py`。
    - **Mock 实现**: 生成一个总是通过的 `pytest` 文件 (e.g., `def test_placeholder(): assert True`)。

## 3.3 Role C (Coding) 接口契约 (Mock)
> 注：Role C 的具体 Agent 实现由队友完成，此处仅实现调用接口。

- [x] **定义 Code Generator 接口 (`adapters/code_adapter.py`)**
    - **Input**:
        - `query`: 原始需求 + "请遵循 tech_spec.md"。
        - `context_files`: [`tech_spec.md`, `tests/test_core.py`]。
    - **Output**: `src/` 目录下的代码。
    - **Mock 实现**: 创建一个简单的 `src/main.py`，打印 "Hello World"。

## 3.4 数据转换逻辑
- [x] **实现 Report -> Spec 转换器**
    - 编写 Prompt 模板，指导 LLM 将自然语言报告转换为结构化 Markdown。
- [x] **实现 Spec -> Test 转换器**
    - 编写 Prompt 模板，指导 LLM 基于 Spec 生成 `pytest` 代码。

## 3.5 集成测试
- [x] **编写 `tests/test_flow.py`**
    - 验证 `wait_for_human_review` 逻辑。
    - 验证数据在 Mock Adapter 之间的流转：Report -> Spec -> Test -> Code。
