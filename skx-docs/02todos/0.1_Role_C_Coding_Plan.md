# Role C: 智能编码代理实施计划 (Coding/Verify Agent)

**责任人**: C 
**目标**: 构建能够根据技术规范和测试用例生成高质量代码的智能代理，并实现自动验证与错误修复机制
**依据**: [00comprehensive_integration_plan.md](../../chao-docs/01goals/00comprehensive_integration_plan.md) 和 [0.0_Role_C_Delivery_Note.md](0.0_Role_C_Delivery_Note.md)

---

## 阶段 0: 架构设计与接口对接 (Day 1)
> **目标**: 确立编码代理架构，与Role A的编排器接口对接，定义数据流转标准

- [ ] **0.1 设计编码代理核心架构**
    - [ ] 创建目录结构：
      ```text
      ms_agent/
      └── agent/
          ├── code_agent.py           # 核心编码代理类
          ├── code_workflow.py        # 代码生成工作流
          ├── verifier.py             # 自动验证器
          └── __init__.py
      projects/
      └── code_assist/
          ├── __init__.py
          ├── architecture.yaml       # 代理架构配置
          ├── coding.yaml             # 编码阶段配置
          └── verification.yaml       # 验证阶段配置
      ```
- [ ] **0.2 实现与编排器的接口契约**
    - [ ] 定义输入：`tech_spec.md` (技术规范) 和 `tests/` 目录 (测试用例)
    - [ ] 定义输出：`src/` 目录（生成的源代码）
    - [ ] 与Role A确认 `code_adapter.py` 的接口规范
- [ ] **0.3 编写配置管理模块**
    - [ ] 实现 `projects/code_assist/coding.yaml`，支持模型、温度、重试次数等参数
    - [ ] 实现 `projects/code_assist/verification.yaml`，支持测试框架、超时等参数

---

## 阶段 1: 核心编码代理开发 (Day 2-3)
> **目标**: 实现基础的编码代理功能，能根据技术规范生成代码

- [ ] **1.1 实现基础编码代理 (`agent/code_agent.py`)**
    - [ ] **类**: `CodeAgent`
    - [ ] **功能**: 接收技术规范文档，生成符合要求的代码文件
    - [ ] **方法**: 
        - `generate_from_spec(spec_path, tests_dir)` - 根据规范和测试生成代码
        - `refine_code(error_log)` - 基于错误日志优化代码
- [ ] **1.2 实现代码工作流 (`agent/code_workflow.py`)**
    - [ ] **类**: `CodeWorkflow`
    - [ ] **功能**: 管理完整的从规范到代码的生成流程
    - [ ] **流程**: 解析规范 → 生成代码 → 运行验证 → 迭代修复
- [ ] **1.3 编写编码提示工程**
    - [ ] 设计用于代码生成的系统提示和用户提示
    - [ ] 集成不同编程语言和框架的代码模板

---

## 阶段 2: 验证系统集成 (Day 3-4)
> **目标**: 集成自动化验证和错误修复机制

- [ ] **2.1 实现代码验证器 (`agent/verifier.py`)**
    - [ ] **类**: `CodeVerifier`
    - [ ] **功能**: 运行预生成的测试用例，验证代码正确性
    - [ ] **输出**: 通过/失败状态，详细的错误日志
- [ ] **2.2 与现有测试框架集成**
    - [ ] 集成 Pytest 框架
    - [ ] 支持单元测试、集成测试的运行
- [ ] **2.3 实现错误修复工作流**
    - [ ] 将错误日志反馈给编码代理
    - [ ] 实现代码自动迭代修复逻辑

---

## 阶段 3: 与编排器集成 (Day 4-5)
> **目标**: 实现与Role A编排器的无缝集成

- [ ] **3.1 开发适配器接口**
    - [ ] 修改 `orchestrator/adapters/code_adapter.py`，替换mock实现
    - [ ] 实现真实的编码代理调用逻辑
- [ ] **3.2 测试集成接口**
    - [ ] 验证编排器能够正确调用编码代理
    - [ ] 测试错误处理和重试机制
- [ ] **3.3 性能优化**
    - [ ] 优化代码生成速度
    - [ ] 实现代码生成缓存机制

---

## 阶段 4: 全链路联调与优化 (Day 5)
> **目标**: 完成与编排器的全链路联调，确保"Spec -> Code -> Verify -> Retry"闭环

- [ ] **4.1 全链路功能验证**
    - [ ] 验证从技术规范到代码生成的完整流程
    - [ ] 验证错误重试机制的有效性
- [ ] **4.2 性能验证**
    - [ ] 验证代码质量和生成效率
    - [ ] 测试大规模代码生成场景
- [ ] **4.3 文档和交付**
    - [ ] 编写用户使用指南
    - [ ] 准备与Role A的接口规范文档

---

## 依赖项
- 需要 Role A 提供 `orchestrator/adapters/code_adapter.py` 的接口规范
- 需要 Role B 提供 `tech_spec.md` 和 `tests/` 标准格式