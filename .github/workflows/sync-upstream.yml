# æ–‡ä»¶å: .github/workflows/sync-upstream.yml
#
# åŠŸèƒ½ï¼šè‡ªåŠ¨åŒæ­¥ä¸Šæ¸¸ä»“åº“ (modelscope/ms-agent) çš„æ›´æ–°åˆ°æ­¤ Fork ä»“åº“

name: ğŸ”„ Sync Upstream

on:
  # 1. å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:
  # 2. å®šæ—¶è§¦å‘ï¼šæ¯å¤©å‡Œæ™¨2ç‚¹ï¼ˆUTCæ—¶é—´ï¼‰è‡ªåŠ¨æ£€æŸ¥ä¸€æ¬¡
  schedule:
    - cron: '0 2 * * *'

jobs:
  sync:
    runs-on: ubuntu-latest
    
    # é™åˆ¶ï¼šåªåœ¨ Y-C-Fan/seu-ms-agent ä»“åº“ä¸Šè¿è¡Œæ­¤å·¥ä½œæµ
    # é˜²æ­¢åœ¨å…¶ä»–äºº fork ä½ çš„ä»“åº“æ—¶ä¹Ÿè¿è¡Œè¿™ä¸ª
    if: github.repository == 'Y-C-Fan/seu-ms-agent'

    steps:
      - name:  checkout
        uses: actions/checkout@v4
        with:
          # æˆ‘ä»¬éœ€è¦è·å–æ‰€æœ‰å†å²è®°å½•ä»¥ä¾¿æ­£ç¡®åˆå¹¶
          fetch-depth: 0 
          # ä½¿ç”¨åœ¨ CI ä¸­ç”Ÿæˆçš„ç‰¹æ®Š token
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: âš¡ Sync Upstream Repo
        uses: repo-sync/github-sync@v2
        with:
          # ä¸Šæ¸¸ä»“åº“ (æºå¤´)
          source_repo: 'https://github.com/modelscope/ms-agent.git'
          source_branch: 'main'
          
          # ç›®æ ‡ä»“åº“ (ä½ çš„ Fork)
          destination_repo: 'https://github.com/Y-C-Fan/seu-ms-agent.git'
          destination_branch: 'main'
          
          # ä½¿ç”¨ä¸Šé¢ checkout æ­¥éª¤æä¾›çš„ GITHUB_TOKEN
          github_token: ${{ secrets.GITHUB_TOKEN }}
          
          # åˆå¹¶ç­–ç•¥ï¼šä½¿ç”¨ 'merge' (ä¿ç•™ä½ çš„ commit å†å²)
          # æ³¨æ„ï¼šå¦‚æœä¸Šæ¸¸æœ‰å¼ºåˆ¶æ¨é€(force-push)ï¼Œè¿™é‡Œå¯èƒ½éœ€è¦æ”¹ä¸º 'force'
          sync_strategy: 'merge'