# Phase 1: 核心架构与基础组件任务清单

**对应阶段**: Phase 0 & Phase 1
**目标**: 建立稳固的 `orchestrator` 项目骨架，实现配置管理、工作区管理和 CLI 入口，为后续模块提供运行环境。

---

## 1.1 项目结构初始化
- [x] **创建目录树**
    - 在项目根目录创建 `orchestrator/`。
    - 创建子模块：
      - `orchestrator/core/` (核心逻辑)
      - `orchestrator/adapters/` (模块适配器)
      - `orchestrator/utils/` (工具函数)
    - 在每个目录下创建 `__init__.py`。

## 1.2 配置管理模块 (`core/config.py`)
- [x] **设计 `Config` 类**
    - 使用 `pydantic` 或原生类管理配置项。
    - **必需配置项**:
        - `OPENAI_API_KEY` / `MODELSCOPE_API_KEY`
        - `OPENAI_BASE_URL`
        - `MODEL_NAME` (默认 Research/Spec 模型)
        - `MAX_RETRIES` (Coding 阶段最大重试次数，默认 3)
        - `WORKSPACE_ROOT` (默认 `workspace/`)
    - **功能**:
        - `load_from_env()`: 从 `.env` 文件加载。
        - `load_from_yaml(path)`: 支持从 YAML 加载（可选）。

## 1.3 工作区管理器 (`core/workspace.py`)
- [x] **设计 `WorkspaceManager` 类**
    - **属性**: `run_id` (时间戳), `root_path`。
    - **方法**:
        - `create(run_id=None)`: 创建形如 `workspace/run_20251126_100000/` 的目录。
        - `get_path(filename)`: 获取当前工作区内文件的绝对路径 (e.g., `report.md`)。
        - `ensure_file(filename, content="")`: 确保文件存在，可选写入初始内容。
        - `list_files(pattern="*")`: 列出工作区文件。
        - `clean()`: (可选) 清理空目录。

## 1.4 日志系统 (`utils/logger.py`)
- [x] **配置 `logging`**
    - 创建 `setup_logger(workspace_path)` 函数。
    - **输出**:
        - Console: INFO 级别，格式简洁。
        - File: `workspace/.../orchestrator.log`，DEBUG 级别，包含时间戳和模块名。

## 1.5 CLI 入口 (`main.py`)
- [x] **使用 `argparse` 实现命令行解析**
    - **参数**:
        - `query` (Positional): 用户的自然语言需求。
        - `--files`: (List): 附加的文件路径列表。
        - `--urls`: (List): 附加的 URL 列表。
        - `--config`: (String): 指定配置文件路径。
    - **逻辑**:
        1. 初始化 Config。
        2. 初始化 WorkspaceManager 并创建目录。
        3. 初始化 Logger。
        4. 打印 "Orchestrator initialized at [workspace_path]"。
- [x] **测试运行**: 确保 `python orchestrator/main.py "test query"` 能成功创建目录并打印日志。
