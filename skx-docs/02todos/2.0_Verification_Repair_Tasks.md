# 2.0 Prompt注入与验证系统任务

**责任人**: Role C
**目标**: 实现Prompt注入机制和验证闭环系统

## 任务列表

### 2.1 实现Prompt注入器
- [ ] 创建 `ms_agent/external_integration/prompt_injector.py`
  - [ ] 定义 `PromptInjector` 类
  - [ ] 实现 `inject(spec_path, test_dir, base_query)` 方法
  - [ ] 实现技术规范和测试用例的读取与格式化
  - [ ] 构造"元指令"，包含遵循spec和通过test的指示

### 2.2 实现测试运行器
- [ ] 创建 `ms_agent/external_integration/test_runner.py`
  - [ ] 定义 `TestRunner` 类
  - [ ] 实现 `run_tests(work_dir)` 方法
  - [ ] 捕获pytest输出和错误日志
  - [ ] 解析测试结果并判断成功/失败

### 2.3 实现错误分析与反馈
- [ ] 增强 `TestRunner` 的错误分析能力
  - [ ] 解析Python异常信息
  - [ ] 提取关键错误位置和原因
  - [ ] 生成错误摘要用于重试
- [ ] 实现错误日志格式化功能

### 2.4 集成验证与注入功能
- [ ] 在Code Scratch调用流程中集成Prompt注入
- [ ] 在Code生成后自动执行验证测试
- [ ] 实现结果反馈机制
